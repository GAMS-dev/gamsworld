*
***************************
* SET UP THE INITIAL DATA *
***************************
*   Problem :
*   *********
*   An orthogonal regression problem,
*   The problem is to fit (orthogonally) an elliptic helix to a
*   set of points in 3D space. This set of points is generated by
*   perturbing a first set lying exactly on a predifined helix
*   centered at the origin.
*   Source:
*   M. Gulliksson,
*   "Algorithms for nonlinear Least-squares with Applications to
*   Orthogonal Regression",
*   UMINF-178.90, University of Umea, Sweden, 1990.
*   SIF input: Ph. Toint, June 1990.
*   classification QOR2-AY-V-V
*   Number of data points
*   (number of variables = 3 NPTS + 6 )
*   True helix Parameter eters (centered at the origin)
*   Perturbation Parameter eters
*   Constants
*   Computed Parameter eters
*   Construct the data points
*   Parameter eters of the helix
*   Projections of the data points onto the helix
*   Solution
$offdigit ;
Parameter   npts ;  npts  =  10;
Parameter    tp4 ;   tp4  =  1.7;
Parameter    tp5 ;   tp5  =  0.8;
Parameter    tp6 ;   tp6  =  2.0;
Parameter  pseed ; pseed  =  237.1531;
Parameter  psize ; psize  =  0.2;
Parameter     pi ;    pi  =  3.1415926535;
Parameter  rnpts ; rnpts  =  10.0;
Parameter   icr0 ;  icr0  =  1.0 / (10.0);
Parameter   incr ;  incr  =  (1.0 / (10.0)) * (2.0 * (3.1415926535));
Parameter    im1 ;   im1  =  -1 + (10);
Parameter   rim1 ;  rim1  =  9.0;
Parameter  theta ; theta  =  (9.0)  * ((1.0/(10.0))*(2.0*(3.1415926535)));
Parameter st ; st = sin((9.0)       * ((1.0/(10.0))*(2.0*(3.1415926535))));
Parameter ct ; ct = cos((9.0)       * ((1.0/(10.0))*(2.0*(3.1415926535))));
Parameter r1 ; r1 = (1.7)*(cos((9.0)*((1.0/(10.0))*(2.0*(3.1415926535)))));
Parameter r2 ; r2 = (0.8)*(sin((9.0)*((1.0/(10.0))*(2.0*(3.1415926535)))));
Parameter r3 ; r3 = (2.0)*((9.0)*((1.0/(10.0))*(2.0*(3.1415926535))));

Parameter xseed ; xseed = ((9.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535)))) * (237.1531);
Parameter sseed ; sseed = cos(((9.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535)))) *(237.1531));
Parameter perm1 ; perm1 = (0.2) * (cos(((9.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535))))* (237.1531)));
Parameter pert ; pert = 1.0 + ((0.2) * (cos(((9.0) * ((1.0 / (10.0)) *(2.0*
                        (3.1415926535)))) * (237.1531))));
Parameter xd1 ; xd1 = ((1.7) * (cos((0.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535))))))* (1.0 + ((0.2) * (cos(((0.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))*
                        (237.1531)))));
Parameter yd1 ; yd1 = ((0.8) * (sin((0.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535))))))* (1.0 + ((0.2) * (cos(((0.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))*
                        (237.1531)))));
Parameter zd1 ; zd1 = ((2.0) * ((0.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535))))) *(1.0 + ((0.2) * (cos(((0.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))*
                        (237.1531)))));
Parameter xd2 ; xd2 = ((1.7) * (cos((1.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535))))))* (1.0 + ((0.2) * (cos(((1.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))*
                        (237.1531)))));
Parameter yd2 ; yd2 = ((0.8) * (sin((1.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535))))))* (1.0 + ((0.2) * (cos(((1.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))*
                        (237.1531)))));
Parameter zd2 ; zd2 = ((2.0) * ((1.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535))))) *(1.0 + ((0.2) * (cos(((1.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))*
                        (237.1531)))));
Parameter xd3 ; xd3 = ((1.7) * (cos((2.0) * ((1.0 / (10.0)) * (2.0*
                        (3.1415926535))))))* (1.0 + ((0.2) * (cos(((2.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))*
                        (237.1531)))));
Parameter yd3 ; yd3 = ((0.8) * (sin((2.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((2.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter zd3 ; zd3 = ((2.0) * ((2.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))) *(1.0 + ((0.2) * (cos(((2.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter xd4 ; xd4 = ((1.7) * (cos((3.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((3.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter yd4 ; yd4 = ((0.8) * (sin((3.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((3.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter zd4 ; zd4 = ((2.0) * ((3.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))) *(1.0 + ((0.2) * (cos(((3.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter xd5 ; xd5 = ((1.7) * (cos((4.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((4.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter yd5 ; yd5 = ((0.8) * (sin((4.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((4.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter zd5 ; zd5 = ((2.0) * ((4.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))) *(1.0 + ((0.2) * (cos(((4.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter xd6 ; xd6 = ((1.7) * (cos((5.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((5.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter yd6 ; yd6 = ((0.8) * (sin((5.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((5.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter zd6 ; zd6 = ((2.0) * ((5.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))) *(1.0 + ((0.2) * (cos(((5.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter xd7 ; xd7 = ((1.7) * (cos((6.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((6.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter yd7 ; yd7 = ((0.8) * (sin((6.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((6.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter zd7 ; zd7 = ((2.0) * ((6.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))) *(1.0 + ((0.2) * (cos(((6.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter xd8 ; xd8 = ((1.7) * (cos((7.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((7.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter yd8 ; yd8 = ((0.8) * (sin((7.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((7.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter zd8 ; zd8 = ((2.0) * ((7.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))) *(1.0 + ((0.2) * (cos(((7.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter xd9 ; xd9 = ((1.7) * (cos((8.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((8.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter yd9 ; yd9 = ((0.8) * (sin((8.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))))* (1.0 + ((0.2) * (cos(((8.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter zd9 ; zd9 = ((2.0) * ((8.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))) *(1.0 + ((0.2) * (cos(((8.0) *
                        ((1.0 / (10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter xd10 ; xd10 = ((1.7) * (cos((9.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535)))))) * (1.0 + ((0.2) * (cos(((9.0)
                        * ((1.0 /(10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter yd10 ; yd10 = ((0.8) * (sin((9.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535)))))) * (1.0 + ((0.2) * (cos(((9.0)
                        * ((1.0 /(10.0)) * (2.0 *(3.1415926535))))
                        *(237.1531)))));
Parameter zd10 ; zd10 = ((2.0) * ((9.0) * ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))) *(1.0 + ((0.2) * (cos(((9.0) *
                        ((1.0 / (10.0)) * (2.0
                        *(3.1415926535))))*(237.1531)))));

Variable  p1 ,   p2 , p3 , p4 , p5 , p6 ,  x1 ,  y1 , z1 ,
          x2 ,   y2 , z2 , x3 , y3 , z3 ,  x4 ,  y4 , z4 ,
          x5 ,   y5 , z5 , x6 , y6 , z6 ,  x7 ,  y7 , z7 ,
          x8 ,   y8 , z8 , x9 , y9 , z9 , x10 , y10 ,z10 ,
          obj ;

Equation  a1 ,  b1 ,  a2 , b2 , a3 , b3 ,
          a4 ,  b4 ,  a5 , b5 , a6 , b6 ,
          a7 ,  b7 ,  a8 , b8 , a9 , b9 ,
         a10 , b10 , Def_obj  ;

 a1..    -((p4)*cos((( z1-p3)/p6))) +  x1 - p1  =e=  0;
 b1..    -((p5)*cos((( z1-p3)/p6))) +  y1 - p2  =e=  0;
 a2..    -((p4)*cos((( z2-p3)/p6))) +  x2 - p1  =e=  0;
 b2..    -((p5)*cos((( z2-p3)/p6))) +  y2 - p2  =e=  0;
 a3..    -((p4)*cos((( z3-p3)/p6))) +  x3 - p1  =e=  0;
 b3..    -((p5)*cos((( z3-p3)/p6))) +  y3 - p2  =e=  0;
 a4..    -((p4)*cos((( z4-p3)/p6))) +  x4 - p1  =e=  0;
 b4..    -((p5)*cos((( z4-p3)/p6))) +  y4 - p2  =e=  0;
 a5..    -((p4)*cos((( z5-p3)/p6))) +  x5 - p1  =e=  0;
 b5..    -((p5)*cos((( z5-p3)/p6))) +  y5 - p2  =e=  0;
 a6..    -((p4)*cos((( z6-p3)/p6))) +  x6 - p1  =e=  0;
 b6..    -((p5)*cos((( z6-p3)/p6))) +  y6 - p2  =e=  0;
 a7..    -((p4)*cos((( z7-p3)/p6))) +  x7 - p1  =e=  0;
 b7..    -((p5)*cos((( z7-p3)/p6))) +  y7 - p2  =e=  0;
 a8..    -((p4)*cos((( z8-p3)/p6))) +  x8 - p1  =e=  0;
 b8..    -((p5)*cos((( z8-p3)/p6))) +  y8 - p2  =e=  0;
 a9..    -((p4)*cos((( z9-p3)/p6))) +  x9 - p1  =e=  0;
 b9..    -((p5)*cos((( z9-p3)/p6))) +  y9 - p2  =e=  0;
a10..    -((p4)*cos(((z10-p3)/p6))) + x10 - p1  =e=  0;
b10..    -((p5)*cos(((z10-p3)/p6))) + y10 - p2  =e=  0;

Def_obj..  obj =e=(( x1 -  xd1)*( x1 -  xd1) + ( y1 )*( y1) + (z1)*(z1) +
                   ( x2 -  xd2)*( x2 -  xd2) + ( y2 -  yd2)*( y2 - yd2) +
                   ( z2 -  zd2)*( z2 -  zd2) + ( x3 -  xd3)*( x3 - xd3) +
                   ( y3 -  yd3)*( y3 -  yd3) + ( z3 -  zd3)*( z3 - zd3) +
                   ( x4 +  xd4)*( x4 +  xd4) + ( y4 -  yd4)*( y4 - yd4) +
                   ( z4 -  zd4)*( z4 -  zd4) + ( x5 +  xd5)*( x5 + xd5) +
                   ( y5 -  yd5)*( y5 -  yd5) + ( z5 -  zd5)*( z5 - zd5) +
                   ( x6 +  xd6)*( x6 +  xd6) + ( y6 -  yd6)*( y6 - yd6) +
                   ( z6 -  zd6)*( z6 -  zd6) + ( x7 +  xd7)*( x7 + xd7) +
                   ( y7 +  yd7)*( y7 +  yd7) + ( z7 -  zd7)*( z7 - zd7) +
                   ( x8 +  xd8)*( x8 +  xd8) + ( y8 +  yd8)*( y8 + yd8) +
                   ( z8 -  zd8)*( z8 -  zd8) + ( x9 -  xd9)*( x9 - xd9) +
                   ( y9 +  yd9)*( y9 +  yd9) + ( z9 -  zd9)*( z9 - zd9) +
                   (x10 - xd10)*(x10 - xd10) + (y10 + yd10)*(y10 +yd10) +
                   (z10 - zd10)*(z10 - zd10))*0.01;

 p6.lo = 0.0010 ;

 p1.l = 1.0                      ;     p2.l = 0                    ;
 p3.l = 1.0                      ;     p4.l = 1.0                  ;
 p5.l = 0                        ;     p6.l = 0.25                 ;
 x1.l = 2.04                     ;     y1.l = 0                    ;
 z1.l = 0                        ;     x2.l = 1.3158481289749517   ;
 y2.l = 0.44989158873434404      ;     z2.l = 1.202289530540075    ;
 x3.l = 0.43008898645023036      ;     y3.l = 0.62290719668541     ;
 z3.l = 2.0576281634294435       ;     x4.l = -0.5892382455447966  ;
 y4.l = 0.8534065167622089       ;     z4.l = 4.2285430952720615   ;
 x5.l = -1.5523083447536603      ;     y5.l = 0.5307378960995349   ;
 z5.l = 5.673372268706862        ;     x6.l = -1.3985753920069166  ;
 y6.l = 5.909729205593858e-11    ;     z6.l = 5.1691225610527205   ;
 x7.l = -1.303813937390017       ;     y7.l = -0.44577707007309214 ;
 z7.l = 7.147763387322456        ;     x8.l = -0.6302880692347891  ;
 y8.l = -0.9128598651915989      ;     z8.l = 10.55396634163662    ;
 x9.l = 0.5072520157785263       ;     y9.l = -0.7346640841993881  ;
 z9.l = 9.707163559929125        ;    x10.l = 1.1210098714058645   ;
y10.l = -0.3832759276080039      ;    z10.l = 9.218393538502124    ;



* AMPL solutions
*p1.fx = -1.758     ;
*p2.fx = 1.9967     ;
*p3.fx = 1.0366     ;  enouph to open this
*p4.fx = 10.027     ;
*p5.fx = -5.29498   ;
*p6.fx = 0.244768   ;  enouph to open this
*x1.fx = 2.03195    ;
*y1.fx = -0.0046782 ;
*z1.fx = -0.211717  ;
*x2.fx = 1.28716    ;
*y2.fx = 0.388623   ;
*z2.fx = 1.34555    ;
*x3.fx = 0.516544   ;
*y3.fx = 0.795568   ;
*z3.fx = 2.24605    ;
*x4.fx = 0.553652   ;
*y4.fx = 0.775973   ;
*z4.fx = 4.43998    ;
*x5.fx = 1.44242    ;
*y5.fx = 0.306639   ;
*z5.fx = 5.3454     ;
*x6.fx = 1.53115    ;
*y6.fx = 0.259783   ;
*z6.fx = 5.34769    ;
*x7.fx = 1.28196    ;
*y7.fx = 0.39137    ;
*z7.fx = 6.8792     ;
*x8.fx = 0.557791   ;
*y8.fx = 0.773787   ;
*z8.fx = 10.5916    ;
*x9.fx = 0.529941   ;
*y9.fx = 0.788494   ;
*z9.fx = 9.936      ;
*x10.fx = 1.15586   ;
*y10.fx = 0.457961  ;
*z10.fx = 9.03852   ;














Model orthrege /all/ ;

Solve orthrege  using nlp minimazing obj ;
 obj.l = obj.l*100;
 display p1.l ; display  p2.l ; display  p3.l ; display  p4.l ;
 display p5.l ; display  p6.l ; display  x1.l ; display  y1.l ;
 display z1.l ; display  x2.l ; display  y2.l ; display  z2.l ;
 display x3.l ; display  y3.l ; display  z3.l ; display  x4.l ;
 display y4.l ; display  z4.l ; display  x5.l ; display  y5.l ;
 display z5.l ; display  x6.l ; display  y6.l ; display  z6.l ;
 display x7.l ; display  y7.l ; display  z7.l ; display  x8.l ;
 display y8.l ; display  z8.l ; display  x9.l ; display  y9.l ;
 display z9.l ; display x10.l ; display y10.l ; display z10.l ;
 display obj.l ;
